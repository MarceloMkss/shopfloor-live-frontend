<h2>Dashboard</h2>

<div class="card">
  <form [formGroup]="form" class="grid grid-3">
    <div>
      <label>De</label>
      <input type="datetime-local"
             [value]="(form.value.from | date:'yyyy-MM-ddTHH:mm')"
             (change)="form.patchValue({from: $any($event.target).value + ':00.000Z'})">
    </div>
    <div>
      <label>A</label>
      <input type="datetime-local"
             [value]="(form.value.to | date:'yyyy-MM-ddTHH:mm')"
             (change)="form.patchValue({to: $any($event.target).value + ':00.000Z'})">
    </div>
    <div style="align-self:end">
      <button type="button" (click)="form.updateValueAndValidity()">Actualizar</button>
    </div>
  </form>

  <!-- skeleton -->
  <ng-template #skeleton>
    <div class="grid grid-3">
      <div class="card skeleton h-28"></div>
      <div class="card skeleton h-28"></div>
      <div class="card skeleton h-28"></div>
    </div>
  </ng-template>

</div>

<div *ngIf="data$ | async as d; else skeleton" class="grid grid-3">
  <div class="card">
    <h3>Produção por máquina</h3>
    <table *ngIf="d.productionByMachine?.length; else noProd">
      <thead><tr><th>Máquina</th><th>Qty</th></tr></thead>
      <tbody>
        <tr *ngFor="let m of d.productionByMachine; trackBy: trackByMachine">
          <td>{{ m.machine }}</td>
          <td>{{ m.qty }}</td>
        </tr>
      </tbody>
    </table>
    <ng-template #noProd><span class="muted">Sem dados.</span></ng-template>
  </div>

  <div class="card">
    <h3>Alarmes por código</h3>
    <table *ngIf="d.alarmsByCode | keyvalue as kvs; else noAlarms">
      <thead><tr><th>Código</th><th>Eventos</th></tr></thead>
      <tbody>
        <tr *ngFor="let a of kvs; trackBy: trackByKey">
          <td>{{ a.key }}</td><td>{{ a.value }}</td>
        </tr>
      </tbody>
    </table>
    <ng-template #noAlarms><span class="muted">Sem alarmes.</span></ng-template>
  </div>

  <div class="card">
    <h3>Temp. média</h3>
    <div class="big">{{ d.avgTemperature | number:'1.0-1' }} °C</div>
  </div>
</div>
